<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>
   Ninja-Braude Medical Data Visualization
  </title>
<!-- Bootstrap CSS -->
<link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet"/>
<!-- Animate.css for animations -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" rel="stylesheet"/>
<!-- Link to your external CSS file -->
<link href="style.css" rel="stylesheet"/>
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-light bg-light">
<a class="navbar-brand" href="#">
    Ninja-Braude
   </a>
<button aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation" class="navbar-toggler" data-target="#navbarNav" data-toggle="collapse" type="button">
<span class="navbar-toggler-icon">
</span>
</button>
<div class="collapse navbar-collapse" id="navbarNav">
<ul class="navbar-nav">
<li class="nav-item">
<a class="nav-link" href="index.html">
       Home
       <span class="sr-only">
        (current)
       </span>
</a>
</li>
<li class="nav-item active">
</li>
</ul>
</div>
</nav>
<div class="headline">
    <h1>
         Analytics
        </h1>
    </div>
    <hr/>
    <div id="allDataContent">
    </div>
    <ul class="liveDataList" id="itemList">
    </ul>
    </div>
    <footer class="footerLiveData">
       Â© 2023 Ninja-Braude - All rights reserved.
      </footer>
<canvas id="sessionsChart" width="400" height="200">
</canvas>
<div class="container">
<!-- Firebase Scripts -->
<script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-app.js">
</script>
<script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-database.js">
</script>
<!-- Link to your external JavaScript file -->
<script src="liveData.js">
</script>
<!-- Bootstrap's JS and Popper.js for the navigation collapse functionality -->
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js">
</script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.3/dist/umd/popper.min.js">
</script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js">
</script>
<script src="https://cdn.jsdelivr.net/npm/chart.js">
</script>
<script>
// Variable to hold the current chart instance
var currentChart = null;

// Fetch the latest 5 session data from Firebase
var sessionsRef = firebase.database().ref('sessions').orderByKey().limitToLast(5);
sessionsRef.once('value', function(snapshot) {
    var sessionsData = snapshot.val();
    var sessionLabels = [];
    var sessionDurations = [];

    // Extract data for the chart
    for (var sessionKey in sessionsData) {
        var session = sessionsData[sessionKey];
        var startTime = session.start ? session.start.timestamp : null;
        var endTime = session.end ? session.end.timestamp : null;

        if (startTime && endTime) {
            var duration = (endTime - startTime) / 1000;  // Convert to seconds
            sessionLabels.push(sessionKey);
            sessionDurations.push(duration);
        }
    }

    // If a chart instance exists, destroy it
    if (currentChart) {
        currentChart.destroy();
    }

    // Update the chart with the fetched data
    var ctx = document.getElementById('sessionsChart').getContext('2d');
    currentChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: sessionLabels,
            datasets: [{
                label: 'Duration (seconds)',
                data: sessionDurations,
                backgroundColor: 'royalblue',
                borderColor: 'black',
                borderWidth: 1
            }]
        },
        options: {
            scales:{
                y: {
                    beginAtZero: true
                }
            },
            responsive: true,
            maintainAspectRatio: true
        }
    });
});
</script>
</body>
</html>